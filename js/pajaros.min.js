function botonPlay(){document.getElementById("inicio").style.display="none",juego.state.start("principal")}function cerrarlayer(){document.getElementById("creditos").style.display="none"}function botonCredits(){document.getElementById("creditos").style.display="block"}function cerrarayuda(){document.getElementById("help").style.display="none"}function botonAyuda(){document.getElementById("help").style.display="block"}function setCookie(e,o,t){var s=new Date;s.setTime(s.getTime()+24*t*60*60*1e3);var i="expires="+s.toUTCString();document.cookie=e+"="+o+";"+i+";path=/"}function getCookie(e){for(var o=e+"=",t=decodeURIComponent(document.cookie),s=t.split(";"),i=0;i<s.length;i++){for(var a=s[i];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(o))return a.substring(o.length,a.length)}return""}var gbs={topScore:0,newRecord:!1,scorePreviousGame:0,isWebAudio:!1,windowWidth:0,windowHeight:0,box:null,groundHeight:0,mountainsHeight:0,columnSpeed:-180,posXNewColumn:0,birdImpulse:-350,gameWidth:362,gameHeight:480,columnWidth:44,antialias:!0},juego=new Phaser.Game(gbs.gameWidth,gbs.gameHeight,Phaser.CANVAS,"div_juego",null,!1,gbs.antialias),scaleAdjustment={create:function(){gbs.box=document.getElementById("div_juego");var e=gbs.box.clientHeight/juego.height;juego.scale.scaleMode=Phaser.ScaleManager.USER_SCALE,juego.scale.setUserScale(e,e),juego.scale.setResizeCallback(function(o,t){gbs.windowWidth==gbs.box.clientWidth&&gbs.windowHeight==gbs.box.clientHeight||(gbs.windowHeight=gbs.box.clientHeight,gbs.windowWidth=gbs.box.clientWidth,e=gbs.windowHeight/juego.height,juego.scale.setUserScale(e,e),gbs.windowWidth>juego.width*e&&(juego.scale.pageAlignHorizontally=!0))},this),juego.state.start("loading")}},loading={create:function(){juego.load.onFileComplete.add(this.fileComplete,this),juego.load.onLoadComplete.add(this.loadComplete,this),this.loadAssets()},loadAssets:function(){juego.device.webAudio&&(gbs.isWebAudio=!0,juego.load.audio("musica","assets/sonidos/PleasantCreekLoop.mp3",!0),juego.load.audio("suelo",["assets/sonidos/suelo.wav","assets/sonidos/suelo.mp3"],!0),juego.load.audio("volar",["assets/sonidos/aleteo.wav","assets/sonidos/aleteo.mp3"],!0),juego.load.audio("gameover",["assets/sonidos/gameover.mp3","assets/sonidos/gameover.wav"],!0),juego.load.audio("punto",["assets/sonidos/punto.wav","assets/sonidos/punto.mp3"],!0)),juego.load.atlasJSONArray("atl_juego","assets/imagenes/lowres_ar133/flappy5.png","assets/imagenes/lowres_ar133/flappy5.json"),juego.load.start()},fileComplete:function(e,o,t,s,i){document.getElementById("p_carga").innerHTML=e+"%"},loadComplete:function(){document.getElementById("loading").style.display="none",juego.state.start("inicio")}},inicio={create:function(){gbs.groundHeight=juego.cache.getFrameData("atl_juego").getFrameByName("layer3").height,gbs.mountainsHeight=juego.cache.getFrameData("atl_juego").getFrameByName("layer2").height,juego.add.image(0,0,"atl_juego","layer1"),juego.add.image(0,juego.height-gbs.groundHeight-gbs.mountainsHeight+10,"atl_juego","layer2"),juego.add.image(0,juego.height-gbs.groundHeight,"atl_juego","layer3"),gbs.topScore=""!=getCookie("best")?parseInt(getCookie("best")):0,document.getElementById("inicio").style.display="block"}},inGame={create:function(){var e=this;this.birdCollided=!1,this.birdHasScored=!1,this.score=0,juego.world.bounds.height=juego.height-68,juego.physics.startSystem(Phaser.Physics.ARCADE),gbs.isWebAudio&&(this.music=juego.add.audio("musica",.4),this.music.play(),this.music.onStop.add(function(){this.music.play()},this),this.suelo=juego.add.audio("suelo",1),this.volar=juego.add.audio("volar",1),this.snd_gameover=juego.add.audio("gameover",1),this.snd_punto=juego.add.audio("punto",1)),this.speedBackground1=-10,this.background0=juego.add.image(0,0,"atl_juego","layer1"),this.background1=juego.add.tileSprite(0,juego.height-gbs.groundHeight-gbs.mountainsHeight+10,juego.width,gbs.mountainsHeight,"atl_juego","layer2"),this.background1.autoScroll(this.speedBackground1,0),this.columns=juego.add.group(),this.columns.enableBody=!0,this.columns.physicsBodyType=Phaser.Physics.ARCADE,this.columnsSpace=200,this.columnsNumber=2,gbs.posXNewColumn=(this.columnsNumber-1)*(this.columnsSpace+gbs.columnWidth)+this.columnsSpace,this.pipesGap=Math.round(100*juego.height/480);for(var o=0;o<e.columnsNumber;o++){var t=-(370*juego.height/600)+130*Math.random(),s=this.columns.create(juego.width+50+o*(gbs.columnWidth+this.columnsSpace),t,"atl_juego","tuberia");s.anchor.setTo(0,.5),s.y+=s.height/2,s.scale.y=-1;var i=this.columns.create(juego.width+50+o*(gbs.columnWidth+this.columnsSpace),s.top+this.pipesGap,"atl_juego","tuberia");s.body.velocity.x=gbs.columnSpeed,i.body.velocity.x=gbs.columnSpeed}e.background2=juego.add.tileSprite(0,juego.height-gbs.groundHeight,juego.width,gbs.groundHeight,"atl_juego","layer3"),e.background2.autoScroll(gbs.columnSpeed,0),e.bird=juego.add.sprite(100,juego.world.centerY,"atl_juego","pato1"),e.bird.anchor.setTo(.5,.5),e.bird.animations.add("flying",["pato1","pato2","pato3","pato4","pato5","pato6","pato7","pato8"],10,!0),e.bird.animations.play("flying"),juego.physics.arcade.enable(this.bird),e.bird.body.gravity.y=1200,e.bird.body.collideWorldBounds=!0,e.bird.body.bounce.y=.3,juego.input.onDown.add(this.fly,this),document.getElementById("marcador").innerHTML="0",document.getElementById("enJuego").style.display="block"},update:function(){this.bird.angle<20&&(this.bird.angle+=1),juego.physics.arcade.collide(this.bird,this.columns,this.columnCollision,null,this),this.resetColumn()},fly:function(){this.bird.body.velocity.y=gbs.birdImpulse,juego.add.tween(this.bird).to({angle:-20},150).start(),gbs.isWebAudio&&this.volar.play()},resetColumn:function(){var e,o,t=this;this.columns.forEach(function(s){s.body.x<-gbs.columnWidth?(.5==s.anchor.y?(e=Math.round(-(175*juego.height/600)+Math.random()*(320*juego.height/600)),s.reset(gbs.posXNewColumn,e),e=s.top):(o=e+t.pipesGap,s.reset(gbs.posXNewColumn,o),t.birdHasScored=!1),s.body.velocity.x=gbs.columnSpeed):s.body.x<t.bird.x-s.width&&!t.birdHasScored&&(gbs.isWebAudio&&t.snd_punto.play(),t.score+=1,document.getElementById("marcador").innerHTML=t.score,t.birdHasScored=!0)})},columnCollision:function(e,o){this.birdCollided||(this.birdCollided=!0,juego.input.onDown.removeAll(),gbs.isWebAudio&&(this.suelo.play(),this.music.onStop.removeAll(),this.music.stop(),this.snd_gameover.play()),this.stopScene(),e.body.angularVelocity=-250,e.body.velocity.x=-30,e.body.collideWorldBounds=!1,o.body.velocity.x=0,o.body.velocity.y=0,juego.camera.shake(.02,200),gbs.scorePreviousGame=this.score,this.checkRecord(),juego.time.events.add(4e3,function(){document.getElementById("enJuego").style.display="none",juego.state.start("gameover")}))},stopScene:function(){this.background1.stopScroll(),this.background2.stopScroll(),this.columns.setAll("body.velocity.x",0)},checkRecord:function(){this.score>gbs.topScore&&(setCookie("best",this.score,365),gbs.topScore=this.score,gbs.newRecord=!0)}},gameOver={create:function(){juego.add.image(0,0,"atl_juego","layer1"),juego.add.image(0,juego.height-gbs.groundHeight-gbs.mountainsHeight+10,"atl_juego","layer2"),juego.add.image(0,juego.height-gbs.groundHeight,"atl_juego","layer3"),document.getElementById("gameOver").style.display="block";var e="";gbs.newRecord?(gbs.newRecord=!1,e=gbs.topScore,document.getElementById("mensaje").innerHTML="NEW RECORD !!!"):e=gbs.scorePreviousGame,document.getElementById("recuento").innerHTML=e,document.getElementById("bestscore").innerHTML=gbs.topScore,juego.input.onDown.add(function(){document.getElementById("gameOver").style.display="none",document.getElementById("mensaje").innerHTML="",juego.state.start("inicio")})}};juego.state.add("ajusteEscala",scaleAdjustment),juego.state.add("loading",loading),juego.state.add("inicio",inicio),juego.state.add("principal",inGame),juego.state.add("gameover",gameOver),juego.state.start("ajusteEscala");