var gbs={topScore:0,newRecord:!1,scorePreviousGame:0,isWebAudio:!1,windowWidth:0,windowHeight:0,box:null,groundHeight:0,mountainsHeight:0,columnSpeed:-180,posXNewColumn:0,birdImpulse:-350,gameWidth:362,gameHeight:480,columnWidth:44,antialias:!0},juego=new Phaser.Game(gbs.gameWidth,gbs.gameHeight,Phaser.CANVAS,"div_juego",null,!1,gbs.antialias),scaleAdjustment={create:function(){gbs.box=document.getElementById("div_juego");var factorEscala=gbs.box.clientHeight/juego.height;juego.scale.scaleMode=Phaser.ScaleManager.USER_SCALE,juego.scale.setUserScale(factorEscala,factorEscala),juego.scale.setResizeCallback(function(escala,parentrectangulo){gbs.windowWidth==gbs.box.clientWidth&&gbs.windowHeight==gbs.box.clientHeight||(gbs.windowHeight=gbs.box.clientHeight,gbs.windowWidth=gbs.box.clientWidth,factorEscala=gbs.windowHeight/juego.height,juego.scale.setUserScale(factorEscala,factorEscala),gbs.windowWidth>juego.width*factorEscala&&(juego.scale.pageAlignHorizontally=!0))},this),juego.state.start("loading")}},loading={create:function(){juego.load.onFileComplete.add(this.fileComplete,this),juego.load.onLoadComplete.add(this.loadComplete,this),this.loadAssets()},loadAssets:function(){juego.device.webAudio&&(gbs.isWebAudio=!0,juego.load.audio("musica","assets/sonidos/musica/PleasantCreekLoop.mp3",!0),juego.load.audio("suelo",["assets/sonidos/suelo.wav","assets/sonidos/suelo.mp3"],!0),juego.load.audio("volar",["assets/sonidos/aleteo.wav","assets/sonidos/aleteo.mp3"],!0),juego.load.audio("gameover",["assets/sonidos/gameover.mp3","assets/sonidos/gameover.wav"],!0),juego.load.audio("punto",["assets/sonidos/punto.wav","assets/sonidos/punto.mp3"],!0)),juego.load.atlasJSONArray("atl_juego","assets/imagenes/lowres_ar133/flappy5.png","assets/imagenes/lowres_ar133/flappy5.json"),juego.load.start()},fileComplete:function(progress,cacheKey,success,totalLoaded,totalFiles){document.getElementById("p_carga").innerHTML=progress+"%"},loadComplete:function(){document.getElementById("loading").style.display="none",juego.state.start("inicio")}},inicio={create:function(){gbs.groundHeight=juego.cache.getFrameData("atl_juego").getFrameByName("layer3").height,gbs.mountainsHeight=juego.cache.getFrameData("atl_juego").getFrameByName("layer2").height,juego.add.image(0,0,"atl_juego","layer1"),juego.add.image(0,juego.height-gbs.groundHeight-gbs.mountainsHeight+10,"atl_juego","layer2"),juego.add.image(0,juego.height-gbs.groundHeight,"atl_juego","layer3"),gbs.topScore=""!=getCookie("best")?parseInt(getCookie("best")):0,document.getElementById("inicio").style.display="block"}},inGame={create:function(){var esto=this;this.birdCollided=!1,this.birdHasScored=!1,this.score=0,juego.world.bounds.height=juego.height-68,juego.physics.startSystem(Phaser.Physics.ARCADE),gbs.isWebAudio&&(this.music=juego.add.audio("musica",.4),this.music.play(),this.music.onStop.add(function(){this.music.play()},this),this.suelo=juego.add.audio("suelo",1),this.volar=juego.add.audio("volar",1),this.snd_gameover=juego.add.audio("gameover",1),this.snd_punto=juego.add.audio("punto",1)),this.speedBackground1=-10,this.background0=juego.add.image(0,0,"atl_juego","layer1"),this.background1=juego.add.tileSprite(0,juego.height-gbs.groundHeight-gbs.mountainsHeight+10,juego.width,gbs.mountainsHeight,"atl_juego","layer2"),this.background1.autoScroll(this.speedBackground1,0),this.columns=juego.add.group(),this.columns.enableBody=!0,this.columns.physicsBodyType=Phaser.Physics.ARCADE,this.columnsSpace=200,this.columnsNumber=2,gbs.posXNewColumn=(this.columnsNumber-1)*(this.columnsSpace+gbs.columnWidth)+this.columnsSpace,this.pipesGap=Math.round(100*juego.height/480);for(var i=0;i<this.columnsNumber;i++){var ceilingPipeY=-370*juego.height/600+130*Math.random(),ceilingPipe=this.columns.create(juego.width+50+i*(gbs.columnWidth+this.columnsSpace),ceilingPipeY,"atl_juego","tuberia");ceilingPipe.anchor.setTo(0,.5),ceilingPipe.y+=ceilingPipe.height/2,ceilingPipe.scale.y=-1;var floorPipe=this.columns.create(juego.width+50+i*(gbs.columnWidth+this.columnsSpace),ceilingPipe.top+this.pipesGap,"atl_juego","tuberia");ceilingPipe.body.velocity.x=gbs.columnSpeed,floorPipe.body.velocity.x=gbs.columnSpeed}this.background2=juego.add.tileSprite(0,juego.height-gbs.groundHeight,juego.width,gbs.groundHeight,"atl_juego","layer3"),this.background2.autoScroll(gbs.columnSpeed,0),this.bird=juego.add.sprite(100,juego.world.centerY,"atl_juego","pato1"),this.bird.anchor.setTo(.5,.5),this.bird.animations.add("flying",["pato1","pato2","pato3","pato4","pato5","pato6","pato7","pato8"],10,!0),this.bird.animations.play("flying"),juego.physics.arcade.enable(this.bird),this.bird.body.gravity.y=1200,this.bird.body.collideWorldBounds=!0,this.bird.body.bounce.y=.3,juego.input.onDown.add(this.fly,this),document.getElementById("marcador").innerHTML="0",document.getElementById("enJuego").style.display="block"},update:function(){this.bird.angle<20&&(this.bird.angle+=1),juego.physics.arcade.collide(this.bird,this.columns,this.columnCollision,null,this),this.resetColumn()},fly:function(){this.bird.body.velocity.y=gbs.birdImpulse,juego.add.tween(this.bird).to({angle:-20},150).start(),gbs.isWebAudio&&this.volar.play()},resetColumn:function(){var esto=this,ceilingPipey,floorPipey;this.columns.forEach(function(item){item.body.x<-gbs.columnWidth?(.5==item.anchor.y?(ceilingPipey=Math.round(-175*juego.height/600+Math.random()*(320*juego.height/600)),item.reset(gbs.posXNewColumn,ceilingPipey),ceilingPipey=item.top):(floorPipey=ceilingPipey+esto.pipesGap,item.reset(gbs.posXNewColumn,floorPipey),esto.birdHasScored=!1),item.body.velocity.x=gbs.columnSpeed):item.body.x<esto.bird.x-item.width&&!esto.birdHasScored&&(gbs.isWebAudio&&esto.snd_punto.play(),esto.score+=1,document.getElementById("marcador").innerHTML=esto.score,esto.birdHasScored=!0)})},columnCollision:function(object1,object2){this.birdCollided||(this.birdCollided=!0,juego.input.onDown.removeAll(),gbs.isWebAudio&&(this.suelo.play(),this.music.onStop.removeAll(),this.music.stop(),this.snd_gameover.play()),this.stopScene(),object1.body.angularVelocity=-250,object1.body.velocity.x=-30,object1.body.collideWorldBounds=!1,object2.body.velocity.x=0,object2.body.velocity.y=0,juego.camera.shake(.02,200),gbs.scorePreviousGame=this.score,this.checkRecord(),juego.time.events.add(4e3,function(){document.getElementById("enJuego").style.display="none",juego.state.start("gameover")}))},stopScene:function(){this.background1.stopScroll(),this.background2.stopScroll(),this.columns.setAll("body.velocity.x",0)},checkRecord:function(){this.score>gbs.topScore&&(setCookie("best",this.score,365),gbs.topScore=this.score,gbs.newRecord=!0)}},gameOver={create:function(){juego.add.image(0,0,"atl_juego","layer1"),juego.add.image(0,juego.height-gbs.groundHeight-gbs.mountainsHeight+10,"atl_juego","layer2"),juego.add.image(0,juego.height-gbs.groundHeight,"atl_juego","layer3"),document.getElementById("gameOver").style.display="block";var textopuntuacion="";gbs.newRecord?(gbs.newRecord=!1,textopuntuacion=gbs.topScore,document.getElementById("mensaje").innerHTML="NEW RECORD !!!"):textopuntuacion=gbs.scorePreviousGame,document.getElementById("recuento").innerHTML=textopuntuacion,document.getElementById("bestscore").innerHTML=gbs.topScore,juego.input.onDown.add(function(){document.getElementById("gameOver").style.display="none",document.getElementById("mensaje").innerHTML="",juego.state.start("inicio")})}};function botonPlay(){document.getElementById("inicio").style.display="none",juego.state.start("principal")}function cerrarlayer(){document.getElementById("creditos").style.display="none"}function botonCredits(){document.getElementById("creditos").style.display="block"}function cerrarayuda(){document.getElementById("help").style.display="none"}function botonAyuda(){document.getElementById("help").style.display="block"}function setCookie(c_name,c_value,c_days){var d=new Date;d.setTime(d.getTime()+24*c_days*60*60*1e3);var expires="expires="+d.toUTCString();document.cookie=c_name+"="+c_value+";"+expires+";path=/"}function getCookie(c_name){for(var name=c_name+"=",decodedCookie,ca=decodeURIComponent(document.cookie).split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(name))return c.substring(name.length,c.length)}return""}juego.state.add("ajusteEscala",scaleAdjustment),juego.state.add("loading",loading),juego.state.add("inicio",inicio),juego.state.add("principal",inGame),juego.state.add("gameover",gameOver),window.onload=function(){juego.state.start("ajusteEscala")};